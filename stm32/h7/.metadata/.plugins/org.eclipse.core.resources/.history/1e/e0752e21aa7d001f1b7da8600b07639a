/*
 * mac.c
 *
 *  Created on: Sep 28, 2024
 *      Author: zero
 */

#include "stm32h7xx.h"

void init_mac_clk(void)
{
	RCC->APB4ENR |= (1<<1);
	RCC->AHB1ENR |= (1<<17)|(1<<16)|(1<<15);

}


void init_mac_pin(void)
{
	GPIOC->MODER &= ~((0b11<<10)|(0b11<<8)|(0b11<<2)); //PC1,PC4,PC5
	GPIOC->MODER |= (0b10<<10)|(0b10<<8)|(0b10<<2);
	GPIOC->AFR[0] &= (0b1111<<20)|(0b1111<<4);
}


void init_mac(void)
{
	SYSCFG->PMCR &= ~(0b111<<21);
	SYSCFG->PMCR |= (0b100<<21);

	ETH->DMAMR |= (1<<0);
	while(!(ETH->DMAMR & (1<<0)));

	ETH->MACMDIOAR &= ~(0b111<<8);
	ETH->MACMDIOAR |= 0b100;


}
